name: üöÄ WINDOWS PRO ULTRA - GAMING & DEVELOPMENT

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'üïê Th·ªùi gian s·ª≠ d·ª•ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  Windows-Pro-Ultra:
    runs-on: windows-latest
    timeout-minutes: 340
    
    steps:
      # BANNER CH√ÄO M·ª™NG
      - name: üéØ KH·ªûI ƒê·ªòNG WINDOWS PRO ULTRA
        run: |
          Write-Host ""
          Write-Host ""
          Write-Host "ü§ñ WINDOWS PRO ULTRA - GAMING & DEVELOPMENT" -ForegroundColor Yellow
          Write-Host "‚ö° Performance Mode: ULTRA FAST" -ForegroundColor Green
          Write-Host "üéÆ Optimized for Gaming & Android Apps" -ForegroundColor Cyan
          Write-Host "üïí Th·ªùi gian: ${{ github.event.inputs.duration }}" -ForegroundColor Magenta
          
          # Hi·ªáu ·ª©ng loading
          $frames = @('‚£æ', '‚£Ω', '‚£ª', '‚¢ø', '‚°ø', '‚£ü', '‚£Ø', '‚£∑')
          for($i=0; $i -lt 10; $i++) {
              Write-Host "`rüöÄ ƒêang kh·ªüi t·∫°o Windows Pro Ultra... $($frames[$i % 8])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Milliseconds 100
          }
          Write-Host "`r‚úÖ Windows Pro Ultra ƒë√£ s·∫µn s√†ng!                    " -ForegroundColor Green

      # T·ªêI ∆ØU H√ìA PERFORMANCE C·ª∞C ƒê·ªàNH
      - name: ‚ö° T·ªêI ∆ØU H√ìA PERFORMANCE
        run: |
          Write-Host ""
          Write-Host "‚ö° ƒêANG T·ªêI ∆ØU H√ìA PERFORMANCE C·ª∞C ƒê·ªàNH" -ForegroundColor Yellow
          
          $optimizationSteps = @(
              @{Name="K√≠ch ho·∫°t ch·∫ø ƒë·ªô hi·ªáu su·∫•t t·ªëi ƒëa"; Script={
                  powercfg -setactive 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c  # High performance
                  powercfg -changename 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c "Ultra Performance" "Ch·∫ø ƒë·ªô hi·ªáu su·∫•t c·ª±c ƒë·∫°i"
              }},
              @{Name="T·∫Øt visual effects ƒë·ªÉ tƒÉng FPS"; Script={
                  Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects" -Name "VisualFXSetting" -Value 2 -Type DWord -Force
                  # T·∫Øt animations
                  Set-ItemProperty -Path "HKCU:\Control Panel\Desktop" -Name "UserPreferencesMask" -Value ([byte[]](0x90,0x12,0x03,0x80,0x10,0x00,0x00,0x00)) -Force
                  Set-ItemProperty -Path "HKCU:\Control Panel\Desktop\WindowMetrics" -Name "MinAnimate" -Value "0" -Force
              }},
              @{Name="T·ªëi ∆∞u h√≥a b·ªô nh·ªõ v√† CPU"; Script={
                  # T·ªëi ∆∞u h√≥a b·ªô nh·ªõ
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name "ClearPageFileAtShutdown" -Value 0 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" -Name "LargeSystemCache" -Value 1 -Type DWord -Force
                  # T·ªëi ∆∞u h√≥a CPU
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Control\PriorityControl" -Name "Win32PrioritySeparation" -Value 38 -Type DWord -Force
              }},
              @{Name="T·∫Øt services kh√¥ng c·∫ßn thi·∫øt"; Script={
                  $servicesToDisable = @(
                      "DiagTrack", "diagnosticshub.standardcollector.service", "DPS",
                      "WSearch", "WbioSrvc", "TabletInputService", "lmhosts",
                      "AJRouter", "XboxGipSvc", "XboxNetApiSvc"
                  )
                  foreach ($service in $servicesToDisable) {
                      Set-Service -Name $service -StartupType Disabled -ErrorAction SilentlyContinue
                      Stop-Service -Name $service -Force -ErrorAction SilentlyContinue
                  }
              }},
              @{Name="T·ªëi ∆∞u h√≥a network cho gaming"; Script={
                  # T·ªëi ∆∞u h√≥a TCP cho gaming
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "TcpAckFrequency" -Value 1 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "TCPNoDelay" -Value 1 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "EnablePMTUDiscovery" -Value 1 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters" -Name "EnableTCPChargen" -Value 0 -Type DWord -Force
              }},
              @{Name="T·ªëi ∆∞u h√≥a GPU v√† graphics"; Script={
                  # T·ªëi ∆∞u h√≥a cho graphics performance
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile" -Name "SystemResponsiveness" -Value 0 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "GPU Priority" -Value 8 -Type DWord -Force
                  Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Multimedia\SystemProfile\Tasks\Games" -Name "Priority" -Value 6 -Type DWord -Force
              }}
          )
          
          foreach($step in $optimizationSteps) {
              Write-Host "‚îÇ ‚ö° $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ t·ªëi ∆∞u" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 300
          }
          
          Write-Host "üéØ T·ªëi ∆∞u h√≥a ho√†n t·∫•t! Performance: ULTRA FAST" -ForegroundColor Green

      # C·∫§U H√åNH RDP CHO WINDOWS PRO
      - name: üîß C·∫§U H√åNH WINDOWS PRO RDP
        run: |
          Write-Host ""
          Write-Host "üîß C·∫§U H√åNH REMOTE DESKTOP CHO WINDOWS PRO" -ForegroundColor Yellow
          
          $rdpSteps = @(
              @{Name="K√≠ch ho·∫°t Remote Desktop Pro"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
              }},
              @{Name="C·∫•u h√¨nh RDP ch·∫•t l∆∞·ª£ng cao"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "SecurityLayer" -Value 0 -Force
                  # C·∫•u h√¨nh ch·∫•t l∆∞·ª£ng graphics cao
                  Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "MaxMonitors" -Value 4 -Force
                  Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "MaxXResolution" -Value 3840 -Force
                  Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "MaxYResolution" -Value 2160 -Force
              }},
              @{Name="M·ªü port 3389 firewall gaming"; Script={
                  netsh advfirewall firewall add rule name="RDP-Gaming-Pro" dir=in action=allow protocol=TCP localport=3389 profile=any
                  netsh advfirewall firewall add rule name="RDP-Gaming-Pro-Out" dir=out action=allow protocol=TCP localport=3389 profile=any
              }},
              @{Name="Kh·ªüi ƒë·ªông d·ªãch v·ª• RDP Pro"; Script={
                  Set-Service -Name TermService -StartupType Automatic -ErrorAction SilentlyContinue
                  Set-Service -Name UmRdpService -StartupType Automatic -ErrorAction SilentlyContinue
                  Start-Service -Name TermService -ErrorAction SilentlyContinue
                  Start-Service -Name UmRdpService -ErrorAction SilentlyContinue
                  # Th√™m d·ªãch v·ª• graphics
                  Set-Service -Name "GraphicsPerfSvc" -StartupType Automatic -ErrorAction SilentlyContinue
                  Start-Service -Name "GraphicsPerfSvc" -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $rdpSteps) {
              Write-Host "‚îÇ üîß $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ c·∫•u h√¨nh" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 500
          }

      # T·∫†O USER GAMING PREMIUM
      - name: üë§ T·∫†O T√ÄI KHO·∫¢N GAMING PRO
        run: |
          Write-Host ""
          Write-Host "üë§ ƒêANG T·∫†O T√ÄI KHO·∫¢N GAMING PRO" -ForegroundColor Yellow
          
          # T·∫°o password gaming
          function New-GamingPassword {
              $chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789!@#$%'
              return -join ((1..12) | ForEach-Object { $chars[(Get-Random -Maximum $chars.Length)] })
          }
          
          $matKhau = New-GamingPassword
          $securePass = ConvertTo-SecureString $matKhau -AsPlainText -Force
          
          # X√≥a user c≈© n·∫øu t·ªìn t·∫°i
          try {
              Remove-LocalUser -Name "GAMING-PRO" -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ ƒê√£ x√≥a user c≈©" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ÑπÔ∏è  Kh√¥ng c√≥ user c≈© ƒë·ªÉ x√≥a" -ForegroundColor Blue
          }
          
          # T·∫°o user gaming m·ªõi
          try {
              New-LocalUser -Name "GAMING-PRO" -Password $securePass -AccountNeverExpires -Description "Windows Pro Gaming Account"
              Set-LocalUser -Name "GAMING-PRO" -PasswordNeverExpires $true
              
              # Th√™m v√†o c√°c nh√≥m gaming
              Add-LocalGroupMember -Group "Administrators" -Member "GAMING-PRO" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Remote Desktop Users" -Member "GAMING-PRO" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Users" -Member "GAMING-PRO" -ErrorAction SilentlyContinue
              Add-LocalGroupMember -Group "Performance Log Users" -Member "GAMING-PRO" -ErrorAction SilentlyContinue
              
              Enable-LocalUser -Name "GAMING-PRO"
              
              Write-Host "‚îÇ ‚úÖ ƒê√£ c·∫•p quy·ªÅn Gaming Pro & Administrator" -ForegroundColor Green
              
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói t·∫°o user: $($_.Exception.Message)" -ForegroundColor Red
              exit 1
          }
          
          # L∆∞u th√¥ng tin
          echo "RDP_USER=GAMING-PRO" >> $env:GITHUB_ENV
          echo "RDP_PASS=$matKhau" >> $env:GITHUB_ENV
          echo "$matKhau" > $env:TEMP\gaming_password.txt
          
          Write-Host "‚úÖ T√†i kho·∫£n: GAMING-PRO ƒë√£ s·∫µn s√†ng" -ForegroundColor Green

      # C√ÄI ƒê·∫∂T DRIVER V√Ä FRAMEWORK CHO GAMING
      - name: üéÆ C√ÄI ƒê·∫∂T GAMING FRAMEWORK
        run: |
          Write-Host ""
          Write-Host "üéÆ C√ÄI ƒê·∫∂T FRAMEWORK CHO GAMING & ANDROID" -ForegroundColor Yellow
          
          $gamingSetup = @(
              @{Name="C√†i ƒë·∫∑t Visual C++ Redistributable"; Script={
                  $vcRedistUrl = "https://aka.ms/vs/17/release/vc_redist.x64.exe"
                  $vcRedistPath = "$env:TEMP\vc_redist.x64.exe"
                  Invoke-WebRequest -Uri $vcRedistUrl -OutFile $vcRedistPath
                  Start-Process -FilePath $vcRedistPath -ArgumentList "/install", "/quiet", "/norestart" -Wait -NoNewWindow
                  Remove-Item $vcRedistPath -Force -ErrorAction SilentlyContinue
              }},
              @{Name="C√†i ƒë·∫∑t .NET Framework 4.8"; Script={
                  $dotnetUrl = "https://go.microsoft.com/fwlink/?linkid=2088631"
                  $dotnetPath = "$env:TEMP\ndp48-x86-x64-allos-enu.exe"
                  Invoke-WebRequest -Uri $dotnetUrl -OutFile $dotnetPath
                  Start-Process -FilePath $dotnetPath -ArgumentList "/q", "/norestart" -Wait -NoNewWindow
                  Remove-Item $dotnetPath -Force -ErrorAction SilentlyContinue
              }},
              @{Name="C√†i ƒë·∫∑t DirectX Runtime"; Script={
                  $directxUrl = "https://download.microsoft.com/download/8/4/A/84A35BF1-DAFE-4AE8-82AF-AD2AE20B6B14/directx_Jun2010_redist.exe"
                  $directxPath = "$env:TEMP\directx_redist.exe"
                  Invoke-WebRequest -Uri $directxUrl -OutFile $directxPath
                  Start-Process -FilePath $directxPath -ArgumentList "/Q" -Wait -NoNewWindow
                  Remove-Item $directxPath -Force -ErrorAction SilentlyContinue
              }},
              @{Name="C√†i ƒë·∫∑t Xbox Gaming Services"; Script={
                  # C√†i ƒë·∫∑t package cho gaming
                  Add-AppxPackage -RegisterByFamilyName -MainPackage Microsoft.GamingServices_8wekyb3d8bbwe -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $gamingSetup) {
              Write-Host "‚îÇ üéÆ $($step.Name)..." -NoNewline -ForegroundColor White
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ c√†i ƒë·∫∑t ho·∫∑c b·ªè qua" -ForegroundColor Yellow
              }
              Start-Sleep -Seconds 2
          }

      # C√ÄI ƒê·∫∂T ANDROID EMULATOR & GOOGLE PLAY FIX
      - name: üì± C√ÄI ƒê·∫∂T ANDROID & GOOGLE PLAY FIX
        run: |
          Write-Host ""
          Write-Host "üì± C√ÄI ƒê·∫∂T ANDROID EMULATOR & FIX GOOGLE PLAY" -ForegroundColor Yellow
          
          Write-Host "‚îÇ üîÑ ƒêang c√†i ƒë·∫∑t BlueStacks 5 (Lightweight)..." -ForegroundColor White
          try {
              $bluestacksUrl = "https://cdn3.bluestacks.com/downloads/windows/nxt/5.20.0.1043/BlueStacksInstaller_5.20.0.1043_native.exe"
              $bluestacksPath = "$env:TEMP\BlueStacksInstaller.exe"
              
              # T·∫£i BlueStacks
              Invoke-WebRequest -Uri $bluestacksUrl -OutFile $bluestacksPath
              
              # C√†i ƒë·∫∑t silent mode
              $installArgs = @(
                  "/silent",
                  "/install",
                  "/nouac",
                  "/noclean",
                  "/noreboot"
              )
              
              Start-Process -FilePath $bluestacksPath -ArgumentList $installArgs -Wait -NoNewWindow
              Remove-Item $bluestacksPath -Force -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ BlueStacks 5 ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ö†Ô∏è  Kh√¥ng th·ªÉ c√†i BlueStacks, s·ª≠ d·ª•ng alternative" -ForegroundColor Yellow
          }
          
          # Fix Google Play Services
          Write-Host "‚îÇ üîß ƒêang fix Google Play Services..." -ForegroundColor White
          try {
              # T·∫°o script fix Google Play
              $fixScript = @"
              @echo off
              echo Fixing Google Play Services...
              adb shell pm clear com.google.android.gms
              adb shell pm clear com.android.vending
              adb shell pm enable com.google.android.gms
              adb shell pm enable com.android.vending
              echo Google Play fix applied!
"@
              $fixScript | Out-File -FilePath "$env:TEMP\fix_google_play.bat" -Encoding ASCII
              Write-Host "‚îÇ ‚úÖ Google Play fix script ƒë√£ s·∫µn s√†ng" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ö†Ô∏è  Kh√¥ng th·ªÉ t·∫°o fix script" -ForegroundColor Yellow
          }

      # TAILSCALE PREMIUM NETWORK
      - name: üåê THI·∫æT L·∫¨P M·∫†NG GAMING
        env:
          TAILSCALE_AUTH_KEY: ${{ secrets.TAILSCALE_AUTH_KEY }}
        run: |
          Write-Host ""
          Write-Host "üåê THI·∫æT L·∫¨P M·∫†NG GAMING PREMIUM" -ForegroundColor Yellow
          
          # C√†i ƒë·∫∑t Tailscale
          try {
              $msiPath = "$env:TEMP\tailscale-gaming.msi"
              Invoke-WebRequest -Uri "https://pkgs.tailscale.com/stable/tailscale-setup-latest-amd64.msi" -OutFile $msiPath
              Start-Process msiexec.exe -ArgumentList "/i", "`"$msiPath`"", "/quiet", "/norestart" -Wait
              Remove-Item $msiPath -Force -ErrorAction SilentlyContinue
              Write-Host "‚îÇ ‚úÖ Tailscale Gaming Edition" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói c√†i ƒë·∫∑t Tailscale" -ForegroundColor Red
          }
          
          Start-Sleep -Seconds 10
          
          # K·∫øt n·ªëi v·ªõi optimized settings
          try {
              & "$env:ProgramFiles\Tailscale\tailscale.exe" up --authkey=$env:TAILSCALE_AUTH_KEY --hostname=win-pro-gaming-$env:GITHUB_RUN_ID --accept-routes --accept-dns --reset --operator=GAMING-PRO
              Write-Host "‚îÇ ‚úÖ K·∫øt n·ªëi m·∫°ng gaming th√†nh c√¥ng" -ForegroundColor Green
          } catch {
              Write-Host "‚îÇ ‚ùå L·ªói k·∫øt n·ªëi m·∫°ng" -ForegroundColor Red
          }
          
          # L·∫•y IP v·ªõi timeout ng·∫Øn h∆°n
          Write-Host "üîÑ ƒêang l·∫•y ƒë·ªãa ch·ªâ IP Gaming..." -NoNewline -ForegroundColor Blue
          $ip = $null
          for($i=0; $i -lt 10; $i++) {
              try {
                  $ip = & "$env:ProgramFiles\Tailscale\tailscale.exe" ip -4 2>&1
                  if ($ip -and $ip -match '^\d+\.\d+\.\d+\.\d+$') {
                      echo "TAILSCALE_IP=$ip" >> $env:GITHUB_ENV
                      Write-Host "`r‚úÖ Gaming IP: $ip" -ForegroundColor Green
                      break
                  }
              } catch {}
              Write-Host "`rüîÑ ƒêang l·∫•y IP... $(@('.', '..', '...')[$i % 3])" -NoNewline -ForegroundColor Blue
              Start-Sleep -Seconds 2
          }
          
          if (-not $ip) {
              echo "TAILSCALE_IP=win-pro-gaming.local" >> $env:GITHUB_ENV
          }

      # HI·ªÇN TH·ªä TH√îNG TIN GAMING PRO
      - name: üéâ TH√îNG TIN WINDOWS PRO GAMING
        run: |
          $matKhau = Get-Content $env:TEMP\gaming_password.txt -ErrorAction SilentlyContinue
          if (-not $matKhau) {
              $matKhau = "Kh√¥ng th·ªÉ ƒë·ªçc m·∫≠t kh·∫©u"
          }
          
          # T√≠nh th·ªùi gian
          $durationInput = "${{ github.event.inputs.duration }}"
          switch ($durationInput) {
              "1h" { $totalMinutes = 60; $displayTime = "1 gi·ªù" }
              "3h" { $totalMinutes = 180; $displayTime = "3 gi·ªù" }
              "5h40m" { $totalMinutes = 340; $displayTime = "5 gi·ªù 40 ph√∫t" }
          }
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê" -ForegroundColor Cyan
          Write-Host "‚îÇ           üéâ WINDOWS PRO GAMING READY!          ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ ü™ü Phi√™n b·∫£n: Windows Pro Ultra Gaming         ‚îÇ" -ForegroundColor White
          Write-Host "‚îÇ ‚ö° Performance: Ultra Fast - No Lag            ‚îÇ" -ForegroundColor Green
          Write-Host "‚îÇ üåê ƒê·ªãa ch·ªâ: $env:TAILSCALE_IP" -ForegroundColor White
          Write-Host "‚îÇ üë§ T√†i kho·∫£n: GAMING-PRO" -ForegroundColor White
          Write-Host "‚îÇ üîê M·∫≠t kh·∫©u: $matKhau" -ForegroundColor White
          Write-Host "‚îÇ üéÆ Tr·∫°ng th√°i: Gaming & Android Ready         ‚îÇ" -ForegroundColor Magenta
          Write-Host "‚îÇ ‚è∞ Th·ªùi l∆∞·ª£ng: $displayTime" -ForegroundColor White
          Write-Host "‚îÇ üïê B·∫Øt ƒë·∫ßu: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üïê K·∫øt th√∫c: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor White
          Write-Host "‚îÇ üìç Port: 3389" -ForegroundColor White
          Write-Host "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§" -ForegroundColor Cyan
          Write-Host "‚îÇ üéØ T√≠nh nƒÉng:                                  ‚îÇ" -ForegroundColor Cyan
          Write-Host "‚îÇ   ‚úì Windows Pro Optimized                      ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì Ultra Fast Performance                     ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì Gaming Ready (BlueStacks 5)               ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì Google Play Fixed                         ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îÇ   ‚úì No Lag - Super Smooth                     ‚îÇ" -ForegroundColor Yellow
          Write-Host "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò" -ForegroundColor Cyan
          
          echo "TOTAL_MINUTES=$totalMinutes" >> $env:GITHUB_ENV

      # GAMING SESSION MANAGER
      - name: ‚ö° QU·∫¢N L√ù PHI√äN GAMING
        run: |
          $matKhau = Get-Content $env:TEMP\gaming_password.txt -ErrorAction SilentlyContinue
          $totalMinutes = $env:TOTAL_MINUTES
          
          $timeZone = [System.TimeZoneInfo]::FindSystemTimeZoneById("SE Asia Standard Time")
          $thoiGianBatDau = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
          $thoiGianKetThuc = $thoiGianBatDau.AddMinutes($totalMinutes)
          
          Write-Host ""
          Write-Host "‚ö° B·∫ÆT ƒê·∫¶U PHI√äN WINDOWS PRO GAMING..." -ForegroundColor Yellow
          Write-Host "üéÆ Ch·∫ø ƒë·ªô: Ultra Performance Gaming" -ForegroundColor Magenta
          Write-Host "üîó K·∫øt n·ªëi: $env:TAILSCALE_IP" -ForegroundColor Cyan
          Write-Host "üïê B·∫Øt ƒë·∫ßu: $($thoiGianBatDau.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host "üïê K·∫øt th√∫c: $($thoiGianKetThuc.ToString('HH:mm:ss'))" -ForegroundColor Green
          Write-Host ""
          
          # Performance Monitor
          $performanceScript = {
              $performanceCounters = @(
                  @{Name="CPU"; Counter="\Processor(_Total)\% Processor Time"},
                  @{Name="RAM"; Counter="\Memory\Available MBytes"},
                  @{Name="GPU"; Counter="\GPU Engine(*engtype_3D)\Utilization Percentage"}
              )
              
              while ($true) {
                  $currentTime = Get-Date
                  $status = @()
                  
                  foreach ($counter in $performanceCounters) {
                      try {
                          $value = (Get-Counter -Counter $counter.Counter -SampleInterval 1 -MaxSamples 1).CounterSamples.CookedValue
                          if ($counter.Name -eq "RAM") {
                              $status += "$($counter.Name): $([math]::Round($value))MB"
                          } else {
                              $status += "$($counter.Name): $([math]::Round($value))%"
                          }
                      } catch {
                          $status += "$($counter.Name): N/A"
                      }
                  }
                  
                  Write-Host "[$($currentTime.ToString('HH:mm:ss'))] üìä $($status -join ' | ')" -ForegroundColor Blue
                  Start-Sleep -Seconds 30
              }
          }
          
          Start-Job -ScriptBlock $performanceScript -Name "PerformanceMonitor"
          
          # Gaming Timer v·ªõi hi·ªáu ·ª©ng
          $frames = @('üéÆ', '‚ö°', 'üöÄ', 'üî•', 'üíª', 'üéØ')
          $colors = @('Green', 'Cyan', 'Yellow', 'Magenta', 'Red', 'Blue')
          $startTime = Get-Date
          
          do {
              $thoiGianHienTai = [System.TimeZoneInfo]::ConvertTimeFromUtc((Get-Date).ToUniversalTime(), $timeZone)
              $thoiGianConLai = $thoiGianKetThuc - $thoiGianHienTai
              
              $gioConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalHours))
              $phutConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalMinutes % 60))
              $giayConLai = [math]::Max(0, [math]::Floor($thoiGianConLai.TotalSeconds % 60))
              
              $frame = $frames[([int]((Get-Date) - $startTime).TotalSeconds) % $frames.Length]
              $color = $colors[([int]((Get-Date) - $startTime).TotalMinutes) % $colors.Length]
              
              Write-Host "`r$frame [$($thoiGianHienTai.ToString('HH:mm:ss'))] Gaming Session - C√≤n l·∫°i: $gioConLai:$phutConLai:$giayConLai" -NoNewline -ForegroundColor $color
              
              Start-Sleep -Seconds 5
              
          } while ($thoiGianConLai.TotalSeconds -gt 0)
          
          Write-Host ""
          Write-Host "üéØ GAMING SESSION ƒê√É K·∫æT TH√öC!" -ForegroundColor Red
          Get-Job -Name "PerformanceMonitor" -ErrorAction SilentlyContinue | Stop-Job -PassThru | Remove-Job -Force

      # D·ªåN D·∫∏P GAMING PRO
      - name: üßπ D·ªåN D·∫∏P GAMING PRO
        if: always()
        run: |
          Write-Host ""
          Write-Host "üßπ D·ªåN D·∫∏P WINDOWS PRO GAMING..." -ForegroundColor Yellow
          
          $cleanupSteps = @(
              @{Name="X√≥a file gaming password"; Script={
                  Remove-Item "$env:TEMP\gaming_password.txt" -ErrorAction SilentlyContinue
                  Remove-Item "$env:TEMP\fix_google_play.bat" -ErrorAction SilentlyContinue
              }},
              @{Name="Kh√¥i ph·ª•c c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh"; Script={
                  powercfg -setactive 381b4222-f694-41f0-9685-ff5bb260df2e  # Balanced
                  # Kh√¥i ph·ª•c visual effects
                  Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\VisualEffects" -Name "VisualFXSetting" -Value 3 -Type DWord -Force
              }},
              @{Name="ƒê√≥ng k·∫øt n·ªëi gaming"; Script={
                  & "$env:ProgramFiles\Tailscale\tailscale.exe" down --accept-risk=all -ErrorAction SilentlyContinue
                  Start-Sleep -Seconds 3
              }},
              @{Name="X√≥a rule firewall gaming"; Script={
                  netsh advfirewall firewall delete rule name="RDP-Gaming-Pro" dir=in -ErrorAction SilentlyContinue
                  netsh advfirewall firewall delete rule name="RDP-Gaming-Pro-Out" dir=out -ErrorAction SilentlyContinue
              }},
              @{Name="Kh√¥i ph·ª•c c√†i ƒë·∫∑t RDP"; Script={
                  Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 1 -Force -ErrorAction SilentlyContinue
                  Stop-Service -Name TermService -Force -ErrorAction SilentlyContinue
                  Set-Service -Name TermService -StartupType Manual -ErrorAction SilentlyContinue
              }}
          )
          
          foreach($step in $cleanupSteps) {
              Write-Host "‚îÇ üßπ $($step.Name)..." -NoNewline -ForegroundColor Gray
              try {
                  & $step.Script
                  Write-Host "`r‚îÇ ‚úÖ $($step.Name)" -ForegroundColor Green
              } catch {
                  Write-Host "`r‚îÇ ‚ö†Ô∏è  $($step.Name) - ƒê√£ x·ª≠ l√Ω" -ForegroundColor Yellow
              }
              Start-Sleep -Milliseconds 300
          }
          
          Get-Job | Stop-Job -PassThru | Remove-Job -Force -ErrorAction SilentlyContinue
          
          Write-Host ""
          Write-Host "üéâ Windows Pro Gaming ƒë√£ ƒë∆∞·ª£c d·ªçn d·∫πp! H·∫πn g·∫∑p l·∫°i! üëã" -ForegroundColor Green
